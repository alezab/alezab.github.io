# Laboratorium - cURL i jq (JSON Query)

Data: 7 października 2025

## Spis treści

- [Zadanie 0.0 - Uruchomienie serwera](#zadanie-00---uruchomienie-serwera)
- [Zadanie 0.1 - Wyświetlanie całego JSON](#zadanie-01---wyświetlanie-całego-json)
- [Zadanie 0.2 - Wyświetlanie konkretnego pola](#zadanie-02---wyświetlanie-konkretnego-pola)
- [Zadanie 0.3 - Pobieranie email](#zadanie-03---pobieranie-email)
- [Zadanie 0.4 - Pobieranie wieku](#zadanie-04---pobieranie-wieku)
- [Zadanie 0.5 - Pobieranie miasta](#zadanie-05---pobieranie-miasta)
- [Zadanie 0.6 - Wyświetlanie tablic](#zadanie-06---wyświetlanie-tablic)
- [Zadanie 0.7 - Sprawdzanie zawartości tablicy](#zadanie-07---sprawdzanie-zawartości-tablicy)
- [Zadanie 0.8 - Dostęp do elementu tablicy](#zadanie-08---dostęp-do-elementu-tablicy)
- [Zadanie 0.9 - Długość tablicy](#zadanie-09---długość-tablicy)
- [Zadanie 0.10 - Interpolacja stringów](#zadanie-010---interpolacja-stringów)
- [Zadanie 0.11 - Iteratory i mapowanie](#zadanie-011---iteratory-i-mapowanie)
- [Zadanie 0.12 - Filtrowanie select](#zadanie-012---filtrowanie-select)
- [Zadanie 0.13 - Filtrowanie mniejsze niż](#zadanie-013---filtrowanie-mniejsze-niż)
- [Zadanie 0.14 - Sortowanie](#zadanie-014---sortowanie)
- [Zadanie 0.15 - Suma wartości](#zadanie-015---suma-wartości)
- [Zadanie 0.16 - Wyszukiwanie tekstowe](#zadanie-016---wyszukiwanie-tekstowe)
- [Zadanie 0.17 - Zakres wartości](#zadanie-017---zakres-wartości)
- [Zadanie 0.18 - Złożone warunki](#zadanie-018---złożone-warunki)
- [Zadanie 0.19 - POST request](#zadanie-019---post-request)
- [Zadanie 0.20 - Dodawanie danych POST](#zadanie-020---dodawanie-danych-post)
- [Zadanie 0.21 - Aktualizacja PUT](#zadanie-021---aktualizacja-put)
- [Zadanie 0.22 - Usuwanie DELETE](#zadanie-022---usuwanie-delete)
- [Zadanie 0.23 - Maksimum](#zadanie-023---maksimum)
- [Zadanie 0.24 - Modyfikacja wartości](#zadanie-024---modyfikacja-wartości)
- [Zadanie 0.25 - Pętle bash](#zadanie-025---pętle-bash)
- [Zadanie 0.26 - Łączenie elementów](#zadanie-026---łączenie-elementów)
- [Zadanie 0.27 - Pierwszy i ostatni element](#zadanie-027---pierwszy-i-ostatni-element)
- [Zadanie 0.28 - Funkcja any](#zadanie-028---funkcja-any)
- [Zadanie 0.29 - POST i lista](#zadanie-029---post-i-lista)
- [Zadanie 0.30 - PUT i aktualizacja](#zadanie-030---put-i-aktualizacja)
- [Podsumowanie](#podsumowanie)

---

## Zadanie 0.0 - Uruchomienie serwera

### Polecenie

Uruchom serwer testowy Docker do ćwiczeń z cURL i jq.

### Rozwiązanie

```bash
docker run -p 5000:5000 docker.io/mazurkatarzyna/curl-jq-server:latest
```

**Opis:**
- Serwer nasłuchuje na porcie `5000`
- Udostępnia endpointy do testowania REST API
- Zawiera dane użytkowników i przedmiotów

---

## Zadanie 0.1 - Wyświetlanie całego JSON

### Polecenie

Wyświetl wszystkie informacje użytkownika Alice.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq .
```

**Output:**
```json
{
  "age": 25,
  "city": "Warsaw",
  "email": "alice@example.com",
  "hobbies": [
    "reading",
    "chess",
    "cycling"
  ],
  "name": "Alice Smith"
}
```

**Wyjaśnienie:**
- `curl -s` - ciche wykonanie (bez progress bar)
- `jq .` - wyświetla cały JSON w ładnym formacie

---

## Zadanie 0.2 - Wyświetlanie konkretnego pola

### Polecenie

Wyświetl imię i nazwisko użytkownika Alice.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r .name
```

**Output:**
```
Alice Smith
```

**Wyjaśnienie:**
- `jq -r` - raw output (bez cudzysłowów)
- `.name` - dostęp do pola `name`

---

## Zadanie 0.3 - Pobieranie email

### Polecenie

Wyświetl adres e-mail użytkownika Bob.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/bob | jq -r .email
```

**Output:**
```
bob@example.com
```

---

## Zadanie 0.4 - Pobieranie wieku

### Polecenie

Wyświetl wiek użytkownika Alice.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r .age
```

**Output:**
```
25
```

---

## Zadanie 0.5 - Pobieranie miasta

### Polecenie

Wyświetl nazwę miasta, w którym mieszka użytkownik Bob.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/bob | jq -r .city
```

**Output:**
```
Krakow
```

---

## Zadanie 0.6 - Wyświetlanie tablic

### Polecenie

Wyświetl hobby użytkownika Alice.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r .hobbies
```

**Output:**
```json
[
  "reading",
  "chess",
  "cycling"
]
```

**Wyjaśnienie:**
- `.hobbies` zwraca całą tablicę w formacie JSON

---

## Zadanie 0.7 - Sprawdzanie zawartości tablicy

### Polecenie

Sprawdź, czy jednym z hobby użytkownika Bob są gry (games).

### Rozwiązanie

#### Metoda 1: Użycie `index`

```bash
curl -s 127.0.0.1:5000/user/bob | jq -r '(.hobbies | index("games")) != null'
```

#### Metoda 2: Użycie `contains`

```bash
curl -s 127.0.0.1:5000/user/bob | jq -r '.hobbies | contains(["games"])'
```

#### Metoda 3: Użycie `any`

```bash
curl -s 127.0.0.1:5000/user/bob | jq -r '.hobbies | any(. == "games")'
```

**Output:**
```
true
```

**Wyjaśnienie:**
- `index("games")` - zwraca indeks elementu lub null
- `contains(["games"])` - sprawdza czy tablica zawiera element
- `any(. == "games")` - sprawdza czy którykolwiek element pasuje

---

## Zadanie 0.8 - Dostęp do elementu tablicy

### Polecenie

Wyświetl pierwsze hobby użytkownika Alice.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r .hobbies[0]
```

**Output:**
```
reading
```

**Wyjaśnienie:**
- `[0]` - indeksowanie od zera (pierwszy element)

---

## Zadanie 0.9 - Długość tablicy

### Polecenie

Sprawdź, ile hobby ma użytkownik Bob, a ile użytkownik Alice.

### Rozwiązanie

#### Z interpolacją tekstu:

```bash
curl -s 127.0.0.1:5000/user/bob | jq '"\(.name) ma \(.hobbies | length) hobby."'
```

**Output:**
```
"Bob Johnson ma 2 hobby."
```

#### Tylko liczba:

```bash
curl -s 127.0.0.1:5000/user/alice | jq '.hobbies | length'
```

**Output:**
```
3
```

#### W pętli dla wielu użytkowników:

```bash
for u in alice bob; do 
  curl -s 127.0.0.1:5000/user/$u | jq -r '.hobbies | length'
done
```

**Output:**
```
3
2
```

**Wyjaśnienie:**
- `length` - zwraca długość tablicy lub stringa
- `\(wyrażenie)` - interpolacja w stringach jq

---

## Zadanie 0.10 - Interpolacja stringów

### Polecenie

Wyświetl nazwę użytkownika i miasto jako jeden ciąg znaków, np. "Alice Smith (Warsaw)". Zmodyfikuj polecenie, aby tekst był wyświetlany jako "Alice Smith from Warsaw".

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq '"\(.name) from \(.city)."'
```

**Output:**
```
"Alice Smith from Warsaw."
```

**Wyjaśnienie:**
- `"\(.name) from \(.city)"` - interpolacja wielu pól w jednym stringu

---

## Zadanie 0.11 - Iteratory i mapowanie

### Polecenie

Wyświetl wszystkie przedmioty. Wyświetl nazwy wszystkich przedmiotów.

### Rozwiązanie

#### Wszystkie przedmioty:

```bash
curl -s 127.0.0.1:5000/items | jq .
```

#### Iterator - same przedmioty (bez nawiasów):

```bash
curl -s 127.0.0.1:5000/items | jq -r .[]
```

#### Iterator - same nazwy:

```bash
# Sposób 1
curl -s 127.0.0.1:5000/items | jq -r .[].name

# Sposób 2 (z pipe)
curl -s 127.0.0.1:5000/items | jq -r '.[] | .name'
```

#### Zapisanie wyniku do listy JSON:

```bash
curl -s 127.0.0.1:5000/items | jq -r 'map(.name)'
```

**Wyjaśnienie:**
- `.[]` - iterator po wszystkich elementach tablicy
- `.[].name` - dla każdego elementu pobierz pole name
- `map(.name)` - mapuje tablicę na nową tablicę zawierającą tylko nazwy

---

## Zadanie 0.12 - Filtrowanie select

### Polecenie

Wyświetl przedmioty droższe niż 20 pln.

### Rozwiązanie

#### Tylko nazwy:

```bash
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.price > 20) | .name'
```

#### W liście JSON:

```bash
curl -s 127.0.0.1:5000/items | jq -r 'map(select(.price > 20)) | map(.name)'
```

**Wyjaśnienie:**
- `select(warunek)` - filtruje elementy spełniające warunek
- Można łączyć `select` z innymi operacjami przez pipe

---

## Zadanie 0.13 - Filtrowanie mniejsze niż

### Polecenie

Wyświetl przedmioty tańsze niż 30 pln.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.price < 30) | .name'
```

---

## Zadanie 0.14 - Sortowanie

### Polecenie

Posortuj przedmioty według ceny rosnąco, a następnie malejąco.

### Rozwiązanie

#### Rosnąco:

```bash
curl -s 127.0.0.1:5000/items | jq -r 'sort_by(.price)'
```

#### Malejąco:

```bash
curl -s 127.0.0.1:5000/items | jq -r 'sort_by(.price) | reverse'
```

**Wyjaśnienie:**
- `sort_by(.pole)` - sortuje tablicę według określonego pola
- `reverse` - odwraca kolejność elementów

---

## Zadanie 0.15 - Suma wartości

### Polecenie

Pobierz sumę cen wszystkich przedmiotów.

### Rozwiązanie

#### Sposób 1: Przez konstrukcję tablicy

```bash
curl -s 127.0.0.1:5000/items | jq -r '[.[].price] | add'
```

#### Sposób 2: Przez mapowanie

```bash
curl -s 127.0.0.1:5000/items | jq -r 'map(.price) | add'
```

**Output:**
```
150.38
```

**Wyjaśnienie:**
- `add` - sumuje wszystkie elementy tablicy
- Działa także dla konkatenacji stringów:

```bash
jq -n '["a", "b", "c"] | add'
# Output: "abc"
```

---

## Zadanie 0.16 - Wyszukiwanie tekstowe

### Polecenie

Wyświetl przedmioty, których nazwa zawiera "item".

### Rozwiązanie

#### Sposób 1: Użycie `contains`

```bash
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.name | contains("item")) | .name'
```

#### Sposób 2: Użycie `test` (regex)

```bash
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.name | test("item")) | .name'
```

#### Sposób 3: Regex case-insensitive

```bash
# "i" - flaga case-insensitive (bez rozróżniania wielkości liter)
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.name | test("item"; "i"))'
```

**Wyjaśnienie:**
- `contains("tekst")` - sprawdza czy string zawiera podany tekst
- `test("pattern")` - sprawdza regex
- `test("pattern"; "i")` - regex z flagami

---

## Zadanie 0.17 - Zakres wartości

### Polecenie

Wyświetl przedmioty w przedziale cenowym 10-30 pln.

### Rozwiązanie

#### Sposób 1: Dwa `select`

```bash
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.price > 10) | select(.price < 30)'
```

#### Sposób 2: Operator `and`

```bash
curl -s 127.0.0.1:5000/items | jq -r '.[] | select(.price > 10 and .price < 30)'
```

**Wyjaśnienie:**
- Można łączyć warunki przez `and` lub `or`
- Można też łączyć wiele `select` w łańcuchu

---

## Zadanie 0.18 - Złożone warunki

### Polecenie

Wyświetl użytkowników, którzy mają więcej niż 2 hobby.

### Rozwiązanie

#### Sprawdzenie true/false:

```bash
for u in alice bob; do 
  curl -s 127.0.0.1:5000/user/$u | jq -r '.hobbies | length > 2'
done
```

#### Wyświetlenie tylko pasujących użytkowników:

```bash
for u in alice bob; do 
  curl -s 127.0.0.1:5000/user/$u | jq -r 'select(.hobbies | length > 2) | .name'
done
```

**Output:**
```
Alice Smith
```

---

## Zadanie 0.19 - POST request

### Polecenie

Wyślij do serwera request typu POST (endpoint /echo) i wyświetl odpowiedź.

### Rozwiązanie

```bash
curl -s -X POST 127.0.0.1:5000/echo \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

**Wyjaśnienie:**
- `-X POST` - metoda HTTP POST
- `-H "Content-Type: application/json"` - nagłówek określający format danych
- `-d '{"key": "value"}'` - dane w formacie JSON

---

## Zadanie 0.20 - Dodawanie danych POST

### Polecenie

Wyślij do serwera request typu POST, który doda nowy przedmiot (użyj endpointa /items). Wyświetl wszystkie przedmioty po dodaniu.

### Rozwiązanie

```bash
# Dodaj nowy przedmiot
curl -s -X POST 127.0.0.1:5000/items \
  -H "Content-Type: application/json" \
  -d '{"name": "Rower", "price": 555}'

# Wyświetl wszystkie przedmioty
curl -s 127.0.0.1:5000/items | jq .
```

**Wyjaśnienie:**
- POST do `/items` dodaje nowy przedmiot
- Serwer automatycznie przypisuje ID

---

## Zadanie 0.21 - Aktualizacja PUT

### Polecenie

Za pomocą requestu typu PUT, zaktualizuj cenę przedmiotu o numerze 1. Wyświetl wszystkie przedmioty.

### Rozwiązanie

```bash
# Aktualizuj przedmiot ID=1
curl -s -X PUT 127.0.0.1:5000/items/1 \
  -H "Content-Type: application/json" \
  -d '{"price": 777}' | jq -r .

# Wyświetl wszystkie przedmioty
curl -s 127.0.0.1:5000/items | jq .
```

**Wyjaśnienie:**
- `PUT /items/1` - aktualizuje przedmiot o ID=1
- Wysyłamy tylko pola do aktualizacji

---

## Zadanie 0.22 - Usuwanie DELETE

### Polecenie

Za pomocą requestu typu DELETE, usuń przedmiot o numerze 3. Wyświetl wszystkie przedmioty.

### Rozwiązanie

```bash
# Usuń przedmiot ID=3
curl -s -X DELETE 127.0.0.1:5000/items/3

# Wyświetl wszystkie przedmioty
curl -s 127.0.0.1:5000/items | jq .
```

**Wyjaśnienie:**
- `DELETE /items/3` - usuwa przedmiot o ID=3

---

## Zadanie 0.23 - Maksimum

### Polecenie

Wyświetl przedmiot o największej cenie.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/items | jq 'sort_by(.price) | .[-1]'
```

**Wyjaśnienie:**
- `sort_by(.price)` - sortuje rosnąco
- `.[-1]` - ostatni element (największy)

**Alternatywa dla minimum:**
```bash
curl -s 127.0.0.1:5000/items | jq 'sort_by(.price) | .[0]'
```

---

## Zadanie 0.24 - Modyfikacja wartości

### Polecenie

Wyświetl wszystkie przedmioty z ceną podwyższoną o 10%.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/items | jq '.[] | .price *= 1.1'
```

**Wyjaśnienie:**
- `*=` - operator mnożenia i przypisania
- Każda cena zostaje pomnożona przez 1.1 (wzrost o 10%)

**Inne operatory:**
- `+=` - dodawanie
- `-=` - odejmowanie
- `/=` - dzielenie

---

## Zadanie 0.25 - Pętle bash

### Polecenie

Pobierz nazwy wszystkich użytkowników i ich wiek.

### Rozwiązanie

```bash
for u in alice bob; do  
  curl -s 127.0.0.1:5000/user/$u | jq -r '"\(.name): \(.age)"'
done
```

**Output:**
```
Alice Smith: 25
Bob Johnson: 30
```

**Wyjaśnienie:**
- Pętla `for` w bash iteruje po użytkownikach
- Dla każdego wykonuje zapytanie i formatuje wynik

---

## Zadanie 0.26 - Łączenie elementów

### Polecenie

Wyświetl hobby Alice jako string połączony przecinkami.

### Rozwiązanie

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r '.hobbies | join(",")'
```

**Output:**
```
reading,chess,cycling
```

**Wyjaśnienie:**
- `join("separator")` - łączy elementy tablicy w string

**Przykład z innym separatorem:**
```bash
curl -s 127.0.0.1:5000/user/alice | jq -r '.hobbies | join(" | ")'
# Output: reading | chess | cycling
```

---

## Zadanie 0.27 - Pierwszy i ostatni element

### Polecenie

Pobierz pierwszy i ostatni przedmiot z listy.

### Rozwiązanie

#### Pierwszy element:

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r '.hobbies[0]'
```

**Output:**
```
reading
```

#### Ostatni element:

```bash
curl -s 127.0.0.1:5000/user/alice | jq -r '.hobbies[-1]'
```

**Output:**
```
cycling
```

**Wyjaśnienie:**
- `[0]` - pierwszy element
- `[-1]` - ostatni element
- `[-2]` - przedostatni element, itd.

---

## Zadanie 0.28 - Funkcja any

### Polecenie

Sprawdź, czy są przedmioty droższe niż 100 pln.

### Rozwiązanie

#### Sposób 1: `any` z iteratorem

```bash
curl -s 127.0.0.1:5000/items | jq 'any(.[]; .price > 100)'
```

#### Sposób 2: `any` na tablicy

```bash
curl -s 127.0.0.1:5000/items | jq '[.[].price] | any(. > 100)'
```

**Output:**
```
true  # lub false
```

**Wyjaśnienie:**
- `any(warunek)` - zwraca true jeśli przynajmniej jeden element spełnia warunek
- `all(warunek)` - zwraca true jeśli wszystkie elementy spełniają warunek

---

## Zadanie 0.29 - POST i lista

### Polecenie

Utwórz nowy przedmiot za pomocą POST /items. Wyświetl odpowiedź serwera i następnie listę wszystkich przedmiotów.

### Rozwiązanie

```bash
# Dodaj przedmiot i wyświetl odpowiedź
curl -s -X POST 127.0.0.1:5000/items \
  -H "Content-Type: application/json" \
  -d '{"name": "Laptop", "price": 2500}' | jq . 

# Wyświetl listę wszystkich przedmiotów
curl -s 127.0.0.1:5000/items | jq .
```

---

## Zadanie 0.30 - PUT i aktualizacja

### Polecenie

Zaktualizuj przedmiot id=2. Wyświetl odpowiedź serwera i następnie listę wszystkich przedmiotów.

### Rozwiązanie

```bash
# Aktualizuj przedmiot ID=2
curl -s -X PUT 127.0.0.1:5000/items/2 \
  -H "Content-Type: application/json" \
  -d '{"name": "Updated Item", "price": 999}' | jq .

# Wyświetl listę wszystkich przedmiotów
curl -s 127.0.0.1:5000/items | jq .
```

---

## Podsumowanie

### Podstawowe komendy cURL

```bash
# GET request
curl -s URL

# POST request
curl -s -X POST URL -H "Content-Type: application/json" -d '{"key": "value"}'

# PUT request
curl -s -X PUT URL -H "Content-Type: application/json" -d '{"key": "value"}'

# DELETE request
curl -s -X DELETE URL
```

**Flagi cURL:**
- `-s` - tryb cichy (bez progress bar)
- `-X` - metoda HTTP (GET, POST, PUT, DELETE)
- `-H` - nagłówek HTTP
- `-d` - dane do wysłania

### Podstawowe operacje jq

| Operacja | Składnia | Przykład |
|----------|----------|----------|
| Cały JSON | `jq .` | `jq .` |
| Pole | `jq .pole` | `jq .name` |
| Raw output | `jq -r` | `jq -r .name` |
| Element tablicy | `jq .[0]` | `jq .hobbies[0]` |
| Ostatni element | `jq .[-1]` | `jq .hobbies[-1]` |
| Iterator | `jq .[]` | `jq .[].name` |
| Długość | `jq length` | `jq '.hobbies \| length'` |
| Filtrowanie | `jq 'select(warunek)'` | `jq 'select(.price > 20)'` |
| Mapowanie | `jq 'map(wyrażenie)'` | `jq 'map(.name)'` |
| Sortowanie | `jq 'sort_by(.pole)'` | `jq 'sort_by(.price)'` |
| Odwracanie | `jq 'reverse'` | `jq 'reverse'` |
| Suma | `jq 'add'` | `jq 'map(.price) \| add'` |
| Łączenie | `jq 'join("sep")'` | `jq '.hobbies \| join(",")'` |
| Interpolacja | `jq '"\(.pole)"'` | `jq '"\(.name): \(.age)"'` |

### Funkcje sprawdzające

```bash
# Sprawdzanie zawartości
.hobbies | contains(["games"])
.hobbies | any(. == "games")
.hobbies | index("games") != null

# Sprawdzanie warunku
any(.[]; .price > 100)
all(.[]; .price < 1000)
```

### Operatory warunkowe

```bash
# Pojedynczy warunek
select(.price > 20)

# Wiele warunków
select(.price > 10 and .price < 30)
select(.price < 10 or .price > 100)

# Negacja
select(.price > 20 | not)
```

### Operatory arytmetyczne

```bash
# Modyfikacja wartości
.price *= 1.1    # Mnożenie
.price += 10     # Dodawanie
.price -= 5      # Odejmowanie
.price /= 2      # Dzielenie
```

### Wyszukiwanie tekstowe

```bash
# Proste wyszukiwanie
select(.name | contains("item"))

# Regex
select(.name | test("item"))

# Regex case-insensitive
select(.name | test("item"; "i"))
```

### REST API - Metody HTTP

| Metoda | Przeznaczenie | Przykład |
|--------|---------------|----------|
| GET | Pobieranie danych | `curl -s URL` |
| POST | Tworzenie nowych | `curl -X POST URL -d '{...}'` |
| PUT | Aktualizacja | `curl -X PUT URL/id -d '{...}'` |
| DELETE | Usuwanie | `curl -X DELETE URL/id` |

### Przydatne konstrukcje bash

```bash
# Pętla po użytkownikach
for u in alice bob; do 
  curl -s URL/user/$u | jq .
done

# Zapisanie do pliku
curl -s URL | jq . > output.json

# Pipe do innych narzędzi
curl -s URL | jq -r .name | grep "pattern"
```

---

**Autor:** Notatki z laboratorium bezpieczeństwa  
**Data:** 7 października 2025
